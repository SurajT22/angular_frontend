import{a as p}from"./chunk-SSSSVC6N.js";import{a as o}from"./chunk-UVREMBGU.js";import{Db as g,J as u,N as a,Wb as E,h as m,r as S,tc as T,uc as c,vb as h,vc as l}from"./chunk-BSMU7QB4.js";var f=(()=>{let t=class t{constructor(){this.TOKEN_KEY="token",this.USER_KEY="user",this.USER_PERMISSIONS_KEY="permissions",this.SCREEN_TIME_OUT_KEY="screen-timeout",this.TOKEN_EXPIRY_TIME_OUT_KEY="token-expiry-timeout",this._permissions=null,this._token=null,this._user=null}getToken(){return this._token?this._token:localStorage.getItem(this.TOKEN_KEY)}setToken(e){this._token=e,localStorage.setItem(this.TOKEN_KEY,e)}removeToken(){this._token=null,localStorage.removeItem(this.TOKEN_KEY)}getTokenExpiryTimeOut(){let e=sessionStorage.getItem(this.TOKEN_EXPIRY_TIME_OUT_KEY);return e?JSON.parse(e):null}setTokenExpiryTimeOut(e){sessionStorage.setItem(this.TOKEN_EXPIRY_TIME_OUT_KEY,JSON.stringify(e))}removeTokenExpiryOut(){sessionStorage.removeItem(this.TOKEN_EXPIRY_TIME_OUT_KEY)}getUser(){if(this._user)return this._user;let e=sessionStorage.getItem(this.USER_KEY);return e?JSON.parse(e):null}setUser(e){e&&(this._user=e,sessionStorage.setItem(this.USER_KEY,JSON.stringify(e)))}removeUser(){this._user=null,sessionStorage.removeItem(this.USER_KEY)}getUserPermissions(){if(this._permissions)return this._permissions;let e=sessionStorage.getItem(this.USER_PERMISSIONS_KEY);if(e){let r=JSON.parse(e);return this._permissions=r,r}return null}setUserPermissions(e){this._permissions=e,sessionStorage.setItem(this.USER_PERMISSIONS_KEY,JSON.stringify(e))}removeUserPermissions(){this._permissions=null,sessionStorage.removeItem(this.USER_PERMISSIONS_KEY)}getScreenTimeOut(){let e=sessionStorage.getItem(this.SCREEN_TIME_OUT_KEY);return e?JSON.parse(e):null}setScreenTimeOut(e){sessionStorage.setItem(this.SCREEN_TIME_OUT_KEY,JSON.stringify(e))}removeScreenTimeOut(){sessionStorage.removeItem(this.SCREEN_TIME_OUT_KEY)}};t.\u0275fac=function(r){return new(r||t)},t.\u0275prov=u({token:t,factory:t.\u0275fac,providedIn:"root"});let i=t;return i})();var I=(()=>{let t=class t{constructor(){this.api=a(l),this.baseUrl="KevinWebService"}login(e){let r=c?.appSettings?.basicAuthUsername,n=c?.appSettings?.basicAuthPass;return this.api.post(`${this.baseUrl}/webapi_GetLogin`,e,{headers:new h({Authorization:"Basic  "+btoa(r+":"+n)})}).pipe(S(s=>s))}authenticateAsync(e){return this.api.post(`${this.baseUrl}/user`,e)}logOut(){return this.api.get(`${this.baseUrl}/logout`)}};t.\u0275fac=function(r){return new(r||t)},t.\u0275prov=u({token:t,factory:t.\u0275fac,providedIn:"root"});let i=t;return i})();var j=(()=>{let t=class t{get IsSuperAdmin(){return this._isSuperAdmin}constructor(){this.storageService=a(f),this.alertService=a(T),this.loaderService=a(E),this.apiAuthService=a(I),this.router=a(g),this.userProfileChange=new m,this._isSuperAdmin=!1}login(e){let r=[""];if(!r)return this.alertService.error("Invalid user role found"),!1;this.storageService.setToken(e.TokenID),this.storageService.setUser(e.UserDetails);var n=parseInt(e.AutoLogoutDuration),s=this.getTokenExpireSeconds(new Date(e.TokenExpiry));return e.AutoLogout&&s>n&&(s=n),this.storageService.setScreenTimeOut(s),this.storageService.setUserPermissions(e.ServerRights),this._isSuperAdmin=e.Master,this.router.navigate(r,{replaceUrl:!0}),this.alertService.success(`Welcome back, ${e.UserDetails.FullName}`),!0}logout(){let e=this.getUser();this.storageService.removeToken(),this.storageService.removeUser(),this.storageService.removeUserPermissions(),this.storageService.removeScreenTimeOut(),this.router.navigate(["login"])}getToken(){return this.storageService.getToken()}getUser(){return this.storageService.getUser()}getUserPermissions(){return this.storageService.getUserPermissions()}getScreenTimeOut(){return this.storageService.getScreenTimeOut()}getUserRoleType(){let e=this.getUser();return e?e.UserType:p.ADMIN}isAuthenticated(){return!!this.storageService.getToken()}hasPermission(e){let r=n=>{var s=this.storageService.getUserPermissions();switch(n){case o.CLIENT_REGISTRATION:return s?.ClientRegistration;case o.BATCH_DETAILS:return s?.BatchDetail;case o.AUDIT_REPORT:return s?.AuditReport;case o.PRODUCTION_REPORT:return s?.ProductionReport;case o.SYSTEM_SETTINGS:return s?.SystemSettings;case o.SERVER_SETTINGS:return s?.ServerSettings;case o.USER_MANAGEMENT:return s?.UserManagement;case o.THIRDPARTY_SETTINGS:return s?.ThirdPartySettings;case o.HELP:return s?.Help;default:return!0}};return this._isSuperAdmin||r(e)===!0}setUser(e){return e&&this.userProfileChange.next(e),this.storageService.setUser(e)}getTokenExpireSeconds(e){let r=new Date,n=new Date(r.getTime()+r.getTimezoneOffset()*6e4);var s=(e.getTime()-n.getTime())/1e3;return s}};t.\u0275fac=function(r){return new(r||t)},t.\u0275prov=u({token:t,factory:t.\u0275fac,providedIn:"root"});let i=t;return i})();export{I as a,j as b};
